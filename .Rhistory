#We choos to load the socio economic
CBS_df <- read_excel("C:/Users/Shahar/Dropbox/zugi/lemida/t01.xls", encoding = "UTF-8")
#We choos to load the socio economic
CBS_df <- read_excel("C:/Users/Shahar/Dropbox/zugi/lemida/t01.xls")
merged_df <- left_join(knesset_df, CBS_df, by)
merged_df
merged_df <- left_join(knesset_df, CBS_df, by = "סמל.ישוב")
merged_df
knesset_df
CBS_df
knesset_df
merged_df <- left_join(CBS_df, knesset_df, by = "סמל.ישוב")
merged_df
#semple 20 locations
Semp_20 <- sample(merged_df$"סמל.ישוב" , 20)
Semp_20
#load the data frames
knesset_df <- read.csv("C:/Users/Shahar/Dropbox/zugi/lemida/knesset_24.csv", encoding = "UTF-8")
#We choos to load the socio economic
CBS_df <- read_excel("C:/Users/Shahar/Dropbox/zugi/lemida/t01.xls")
#first, we merge the data frames to find the matching locations in both.
merged_df <- left_join(CBS_df, knesset_df, by = "סמל.ישוב")
#semple 20 locations
Semp_20 <- sample(merged_df$"סמל.ישוב" , 20)
Semp_20
# sum all the votes for each location
#calculate the persents of votes for each party in every location
knesset_df_norm <- knesset_df1 %>%rowwise %>% mutate(total_votes = sum(c_across( 8:46))) %>% ungroup() %>%  mutate(round(across(8:46, ~ . / total_votes),3))
# sum all the votes for each location
#calculate the persents of votes for each party in every location
knesset_df_norm <- knesset_df %>%rowwise %>% mutate(total_votes = sum(c_across( 8:46))) %>% ungroup() %>%  mutate(round(across(8:46, ~ . / total_votes),3))
knesset_df_norm
s
s
#filter each data frame for the sempled values.
knesset_semp20 <- filter(knesset_df_norm, knesset_df_norm$"סמל.ישוב" %in% Semp_20)
knesset_semp20
# sum all the votes for each location
#calculate the persents of votes for each party in every location
knesset_df_norm <- knesset_df %>%rowwise %>% mutate(total_votes = sum(c_across( 8:46))) %>% ungroup() %>%  mutate(round(across(8:46, ~ . / total_votes),3))
knesset_df_norm
#filter each data frame for the sempled values.
knesset_semp20 <- filter(knesset_df_norm, knesset_df_norm$"סמל.ישוב" %in% Semp_20)
#first, we merge the data frames to find the matching locations in both.
merged_df <- left_join(CBS_df, knesset_df, by = "סמל.ישוב")
#semple 20 locations
Semp_20 <- sample(merged_df$"סמל.ישוב" , 20)
# sum all the votes for each location
#calculate the persents of votes for each party in every location
knesset_df_norm <- knesset_df %>%rowwise %>% mutate(total_votes = sum(c_across( 8:46))) %>% ungroup() %>%  mutate(round(across(8:46, ~ . / total_votes),3))
#filter each data frame for the sempled values.
knesset_semp20 <- filter(knesset_df_norm, knesset_df_norm$"סמל.ישוב" %in% Semp_20)
CBS_semp20 <- filter(CBS_df1, CBS_df1$"סמל.ישוב" %in% Semp_20)
knesset_semp20
CBS_semp20 <- filter(CBS_df1, CBS_df1$"סמל.ישוב" %in% Semp_20)
CBS_semp20 <- filter(CBS_df, CBS_df$"סמל.ישוב" %in% Semp_20)
CBS_semp20
knesset_semp20
votes_dist <-  knesset_semp20[,c(8:46)] %>% dist
clus <- hcut(votes_dist, k = 4, hc_func = 'hclust',
hc_method = 'single', graph = FALSE, isdiss = TRUE)
library('MASS')
library(data.table)
library(ggplot2)
library(kableExtra)
library(dplyr)
library(dendextend)
library(readxl)
library(fuzzyjoin)
library(stringr)
library(ggdendro)
library(viridis)
votes_dist <-  knesset_semp20[,c(8:46)] %>% dist
clus <- hcut(votes_dist, k = 4, hc_func = 'hclust',
hc_method = 'single', graph = FALSE, isdiss = TRUE)
library(factoextra)
votes_dist <-  knesset_semp20[,c(8:46)] %>% dist
clus <- hcut(votes_dist, k = 4, hc_func = 'hclust',
hc_method = 'single', graph = FALSE, isdiss = TRUE)
dend <- as.dendrogram(clus)
labels(dend) <- knesset_semp20$"שם.ישוב"
dend <- sort(dend, decreasing = FALSE)
g1 <- ggplot(dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.6),
horiz = TRUE)
g1
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avgabroad'))] %>% scale %>% dist
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avgabroad'))] %>% scale %>% dist
CBS_semp20
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avg_abroad'))] %>% scale %>% dist
CBS_semp20
colnames(CBS_semp20)
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avg_abroad'))] %>% scale %>% dist
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avg_abroad'))] %>% scale %>% dist
living_stand_dist
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avg_abroad'))] %>% scale %>% dist
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avg_abroad'))] %>% scale %>% dist
CBS_semp20
CBS_df <- read_excel("C:/Users/Shahar/Dropbox/zugi/lemida/t01.xls")
CBS_df
View(CBS_df)
CBS_df[3:19]
CBS_df[3:19,]
CBS_df[3:19,] <- as.numeric(CBS_df[3:19,])
CBS_df
CBS_df$`median age` <- as.numeric(CBS_df$`median age`)
CBS_df
#load the data frames
knesset_df <- read.csv("C:/Users/Shahar/Dropbox/zugi/lemida/knesset_24.csv", encoding = "UTF-8")
CBS_df <- read_excel("C:/Users/Shahar/Dropbox/zugi/lemida/t01.xls")
CBS_df
votes_dist <-  knesset_semp20[,c(8:46)] %>% dist
clus <- hcut(votes_dist, k = 4, hc_func = 'hclust',
hc_method = 'single', graph = FALSE, isdiss = TRUE)
dend <- as.dendrogram(clus)
labels(dend) <- knesset_semp20$"שם.ישוב"
dend <- sort(dend, decreasing = FALSE)
g1 <- ggplot(dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.6),
horiz = TRUE)
g1
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avg_abroad'))] %>% scale %>% dist
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avg_abroad'))] %>% scale %>% dist
CBS_semp20
CBS_df
#first, we merge the data frames to find the matching locations in both.
merged_df <- left_join(CBS_df, knesset_df, by = "סמל.ישוב")
#semple 20 locations
Semp_20 <- sample(merged_df$"סמל.ישוב" , 20)
# sum all the votes for each location
#calculate the persents of votes for each party in every location
knesset_df_norm <- knesset_df %>%rowwise %>% mutate(total_votes = sum(c_across( 8:46))) %>% ungroup() %>%  mutate(round(across(8:46, ~ . / total_votes),3))
#filter each data frame for the sempled values.
knesset_semp20 <- filter(knesset_df_norm, knesset_df_norm$"סמל.ישוב" %in% Semp_20)
CBS_semp20 <- filter(CBS_df, CBS_df$"סמל.ישוב" %in% Semp_20)
votes_dist <-  knesset_semp20[,c(8:46)] %>% dist
clus <- hcut(votes_dist, k = 4, hc_func = 'hclust',
hc_method = 'single', graph = FALSE, isdiss = TRUE)
dend <- as.dendrogram(clus)
labels(dend) <- knesset_semp20$"שם.ישוב"
dend <- sort(dend, decreasing = FALSE)
g1 <- ggplot(dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.6),
horiz = TRUE)
g1
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avg_abroad'))] %>% scale %>% dist
clus1 <- hcut(living_stand_dist, k = 4, hc_func = 'hclust',
hc_method = 'single')
dend1 <- as.dendrogram(clus1)
labels(dend1) <- knesset_semp20$"שם.ישוב"
dend1 <- sort(dend1, decreasing = FALSE)
g2 <- ggplot(dend1 %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.6),
horiz = TRUE)
g2
#first, we merge the data frames to find the matching locations in both.
merged_df <- left_join(CBS_df, knesset_df, by = "סמל.ישוב")
#semple 20 locations
Semp_20 <- sample(merged_df$"סמל.ישוב" , 20)
# sum all the votes for each location
#calculate the persents of votes for each party in every location
knesset_df_norm <- knesset_df %>%rowwise %>% mutate(total_votes = sum(c_across( 8:46))) %>% ungroup() %>%  mutate(round(across(8:46, ~ . / total_votes),3))
#filter each data frame for the sempled values.
knesset_semp20 <- filter(knesset_df_norm, knesset_df_norm$"סמל.ישוב" %in% Semp_20)
CBS_semp20 <- filter(CBS_df, CBS_df$"סמל.ישוב" %in% Semp_20)
votes_dist <-  knesset_semp20[,c(8:46)] %>% dist
clus <- hcut(votes_dist, k = 4, hc_func = 'hclust',
hc_method = 'single', graph = FALSE, isdiss = TRUE)
dend <- as.dendrogram(clus)
labels(dend) <- knesset_semp20$"שם.ישוב"
dend <- sort(dend, decreasing = FALSE)
g1 <- ggplot(dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.6),
horiz = TRUE)
g1
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avg_abroad'))] %>% scale %>% dist
clus1 <- hcut(living_stand_dist, k = 4, hc_func = 'hclust',
hc_method = 'single')
dend1 <- as.dendrogram(clus1)
labels(dend1) <- knesset_semp20$"שם.ישוב"
dend1 <- sort(dend1, decreasing = FALSE)
g2 <- ggplot(dend1 %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.6),
horiz = TRUE)
g2
hc1 <- hclust(votes_dist, method = "single")
hc2 <- hclust(living_stand_dist, method = "single")
labels(hc1) <- knesset_semp20$`שם יישוב`
labels(hc2) <- CBS_semp20$`שם יישוב`
# Create two dendrograms
dend1 <- as.dendrogram (hc1)
dend2 <- as.dendrogram (hc2)
tanglegram(dend1, dend2)
merged_df
knesst_dist <- knesset_semp20[,c(8:46)] %>% dist %>% hclust(method = "single")
knesst_dist
plot(knesst_dist)
plot(knesst_dist, labels = knesset_semp20$שם.ישוב)
plot(knesst_dist, labels = knesset_semp20$'שם.ישוב', hang = -1)
plot(knesst_dist, labels = knesset_semp20$'שם.ישוב', hang = -1, cex = 0.6)
plot(knesst_dist, labels = knesset_semp20$'שם.ישוב', hang = -1, cex = 0.8)
plot(knesst_dist, labels = knesset_semp20$'שם.ישוב', hang = -1, cex = 0.8, xlab = "City")
knesst_dist <- knesset_semp20[,c(8:46)] %>% dist %>% hclust(method = "single") %>% dend
knesst_dist <- knesset_semp20[,c(8:46)] %>% dist %>% hclust(method = "single") %>% as.dendrogram
plot(knesst_dist, labels = knesset_semp20$'שם.ישוב', hang = -1, cex = 0.8, xlab = "City")
knesst_dend <- as.dendrogram(knesst_dist)
plot(knesst_dend, labels = knesset_semp20$'שם.ישוב', hang = -1, cex = 0.8, xlab = "City")
plot(knesst_dend)#, labels = knesset_semp20$'שם.ישוב', hang = -1, cex = 0.8, xlab = "City")
plot(knesst_dend, type = 'rectangle')
plot(knesst_dend, type = 'rectangle')
plot(knesst_dend)
, type = 'rectangle'
plot(knesst_dend, type = 'rectangle')
plot(knesst_dend, type = 'rectangle', leaflab = knesset_semp20$שם.ישוב)
plot(knesst_dend, type = 'rectangle', leaflab = knesset_semp20$'שם.ישוב')
plot(knesst_dend, type = 'rectangle', nodePar = knesset_semp20$'שם.ישוב')
plot(knesst_dend, type = 'rectangle', leaflab = knesset_semp20$'שם.ישוב', horiz = T)
ggplot(knesst_dend)
label(knesst_dend) <- knesset_semp20$'שם.ישוב'
labels(knesst_dend) <- knesset_semp20$'שם.ישוב'
ggplot(knesst_dend)
plot(knesst_dend)
plot(knesst_dend, ylab = "Hight")
plot(knesst_dend, ylab = "Hight", xlab = "City")
plot(knesst_dend, ylab = "Hight", horiz = T)
plot(knesst_dend, ylab = "Hight")
ggplot(knesst_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.6),
horiz = TRUE)
ggplot(knesst_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.6))
ggplot(knesst_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avg_abroad'))] %>% scale %>% dist
CBS_dist <- living_stand_dist %>% scale %>% dist %>% hclust(method = "single")
CBS_dend <- as.dendrogram(CBS_dist)
labels(CBS_dend) <- CBS_semp20$`location name`
ggplot(CBS_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
knesst_dist <- knesset_semp20[,c(8:46)] %>% dist %>% hclust(method = "single")
knesst_dend <- as.dendrogram(knesst_dist)
labels(knesst_dend) <- knesset_semp20$'שם.ישוב'
ggplot(knesst_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
knesst_dist <- knesset_semp20[,c(8:46)] %>% scale%>% dist %>% hclust(method = "single")
knesst_dend <- as.dendrogram(knesst_dist)
labels(knesst_dend) <- knesset_semp20$'שם.ישוב'
ggplot(knesst_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
knesst_dist <- knesset_semp20[,c(8:46)] %>% dist %>% hclust(method = "single")
knesst_dend <- as.dendrogram(knesst_dist)
labels(knesst_dend) <- knesset_semp20$'שם.ישוב'
ggplot(knesst_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avg_abroad'))]
CBS_dist <- living_stand_dist %>% scale %>% dist %>% hclust(method = "single")
CBS_dend <- as.dendrogram(CBS_dist)
labels(CBS_dend) <- CBS_semp20$`location name`
ggplot(CBS_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
ggplot(CBS_dend %>% set('branches_k_color', k = 3) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 3) %>%
set('labels_cex', 0.8),
horiz = TRUE)
ggplot(CBS_dend %>% set('branches_k_color', k = 2) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 2) %>%
set('labels_cex', 0.8),
horiz = TRUE)
ggplot(CBS_dend %>% set('branches_k_color', k = 5) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 5) %>%
set('labels_cex', 0.8),
horiz = TRUE)
ggplot(CBS_dend %>% set('branches_k_color', k = 3) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 3) %>%
set('labels_cex', 0.8),
horiz = TRUE)
ggplot(knesst_dend %>% set('branches_k_color', k = 3) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 3) %>%
set('labels_cex', 0.8),
horiz = TRUE)
ggplot(knesst_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
ggplot(CBS_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.6) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
ggplot(CBS_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.8) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
ggplot(CBS_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.7) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
ggplot(knesst_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.7) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
CBS_plot <- ggplot(CBS_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.7) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
CBS_plot
Knesst_plot <- ggplot(knesst_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.7) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
library('MASS')
library(data.table)
library(ggplot2)
library(kableExtra)
library(dplyr)
library(dendextend)
library(readxl)
library(fuzzyjoin)
library(stringr)
library(ggdendro)
library(viridis)
library(factoextra)
#load the data frames
knesset_df <- read.csv("C:/Users/Shahar/Dropbox/zugi/lemida/knesset_24.csv", encoding = "UTF-8")
CBS_df <- read_excel("C:/Users/Shahar/Dropbox/zugi/lemida/t01.xls")
#first, we merge the data frames to find the matching locations in both.
merged_df <- left_join(CBS_df, knesset_df, by = "סמל.ישוב")
#semple 20 locations
Semp_20 <- sample(merged_df$"סמל.ישוב" , 20)
# sum all the votes for each location
#calculate the persents of votes for each party in every location
knesset_df_norm <- knesset_df %>%rowwise %>% mutate(total_votes = sum(c_across( 8:46))) %>% ungroup() %>%  mutate(round(across(8:46, ~ . / total_votes),3))
#filter each data frame for the sempled values.
knesset_semp20 <- filter(knesset_df_norm, knesset_df_norm$"סמל.ישוב" %in% Semp_20)
CBS_semp20 <- filter(CBS_df, CBS_df$"סמל.ישוב" %in% Semp_20)
knesst_dist <- knesset_semp20[,c(8:46)] %>% dist %>% hclust(method = "single")
knesst_dend <- as.dendrogram(knesst_dist)
labels(knesst_dend) <- knesset_semp20$'שם.ישוב'
Knesst_plot <- ggplot(knesst_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.7) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
# Knesst_plot
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avg_abroad'))]
CBS_dist <- living_stand_dist %>% scale %>% dist %>% hclust(method = "single")
CBS_dend <- as.dendrogram(CBS_dist)
labels(CBS_dend) <- CBS_semp20$`location name`
CBS_plot <- ggplot(CBS_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.7) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
# CBS_plot
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avg_abroad'))]
CBS_dist <- living_stand_dist %>% scale %>% dist %>% hclust(method = "single")
CBS_dend <- as.dendrogram(CBS_dist)
labels(CBS_dend) <- CBS_semp20$`location name`
CBS_plot <- ggplot(CBS_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.7) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
# CBS_plot
CBS_plot
CBS_dend
dend_list <- dendlist(knesst_dend, CBS_dend)
dend_list <- dendlist(knesst_dend, CBS_dend) %<%  untangle(method = "step1side") %<% tanglegram)
dend_list <- dendlist(knesst_dend, CBS_dend) %<%  untangle(method = "step1side") %<% tanglegram()
dend_list <- dendlist(knesst_dend, CBS_dend) %<%  untangle(method = "step1side") %<% tanglegram()
dend_list <- dendlist(knesst_dend, CBS_dend) %>%  untangle(method = "step1side") %>% tanglegram()
knesset_df
names_df <- as.data.frame(knesset_df$'סמל.ישוב', knesset_df$'שם.ישוב')
names_df
names_df <- as.data.frame(c(knesset_df$'סמל.ישוב', knesset_df$'שם.ישוב'))
names_df
names_df <- as.data.frame(knesset_df[2:3,])
names_df
names_df <- as.data.frame(knesset_df[,2:3])
names_df
CBS_df <- left_join(CBS_df, names_df)
CBS_df
#load the data frames
knesset_df <- read.csv("C:/Users/Shahar/Dropbox/zugi/lemida/knesset_24.csv", encoding = "UTF-8")
CBS_df <- read_excel("C:/Users/Shahar/Dropbox/zugi/lemida/t01.xls")
#first, we merge the data frames to find the matching locations in both.
merged_df <- left_join(CBS_df, knesset_df, by = "סמל.ישוב")
#add "שם.ישוב" coloumn to the CBS data frame
names_df <- as.data.frame(knesset_df[,2:3])
CBS_df <- left_join(CBS_df, names_df)
#semple 20 locations
Semp_20 <- sample(merged_df$"סמל.ישוב" , 20)
# sum all the votes for each location
#calculate the persents of votes for each party in every location
knesset_df_norm <- knesset_df %>%rowwise %>% mutate(total_votes = sum(c_across( 8:46))) %>% ungroup() %>%  mutate(round(across(8:46, ~ . / total_votes),3))
#filter each data frame for the sempled values.
knesset_semp20 <- filter(knesset_df_norm, knesset_df_norm$"סמל.ישוב" %in% Semp_20)
CBS_semp20 <- filter(CBS_df, CBS_df$"סמל.ישוב" %in% Semp_20)
```{r,message=F}
#first, we merge the data frames to find the matching locations in both.
merged_df <- left_join(CBS_df, knesset_df, by = "סמל.ישוב")
#add "שם.ישוב" coloumn to the CBS data frame
names_df <- as.data.frame(knesset_df[,2:3])
CBS_df <- left_join(CBS_df, names_df)
#semple 20 locations
Semp_20 <- sample(merged_df$"סמל.ישוב" , 20)
# sum all the votes for each location
#calculate the persents of votes for each party in every location
knesset_df_norm <- knesset_df %>%rowwise %>% mutate(total_votes = sum(c_across( 8:46))) %>% ungroup() %>%  mutate(round(across(8:46, ~ . / total_votes),3))
#filter each data frame for the sempled values.
knesset_semp20 <- filter(knesset_df_norm, knesset_df_norm$"סמל.ישוב" %in% Semp_20)
CBS_semp20 <- filter(CBS_df, CBS_df$"סמל.ישוב" %in% Semp_20)
knesst_dist <- knesset_semp20[,c(8:46)] %>% dist %>% hclust(method = "single")
knesst_dend <- as.dendrogram(knesst_dist)
labels(knesst_dend) <- knesset_semp20$'שם.ישוב'
Knesst_plot <- ggplot(knesst_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.7) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
# Knesst_plot
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avg_abroad'))]
CBS_dist <- living_stand_dist %>% scale %>% dist %>% hclust(method = "single")
CBS_dend <- as.dendrogram(CBS_dist)
labels(CBS_dend) <- CBS_semp20$סמל.ישוב
CBS_plot <- ggplot(CBS_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.7) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
# CBS_plot
dend_list <- dendlist(knesst_dend, CBS_dend) %>%  untangle(method = "step1side") %>% tanglegram()
labels(CBS_dend) <- CBS_semp20$שם.ישוב
CBS_plot <- ggplot(CBS_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.7) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
# CBS_plot
### Q4
#כאן צריך לכתוב על קווי דמיון ושוני בין שתי הדנדוגרמות
```{r}
dend_list <- dendlist(knesst_dend, CBS_dend) %>%  untangle(method = "step1side") %>% tanglegram()
knesst_dend
CBS_dend
dend_list <- dendlist(knesst_dend, CBS_dend) %>%  untangle(method = "step1side") %>% tanglegram()
dend_list <- dendlist(knesst_dend, CBS_dend) %>%  untangle() %>% tanglegram()
knesst_dist <- knesset_semp20[,c(8:46)] %>% dist %>% hclust(method = "single")
knesst_dend <- as.dendrogram(knesst_dist)
#labels(knesst_dend) <- knesset_semp20$'שם.ישוב'
Knesst_plot <- ggplot(knesst_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.7) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
# Knesst_plot
living_stand_dist <- CBS_semp20[which(colnames(CBS_semp20) %in% c('income', 'motorization','avgvehicle','avg_abroad'))]
CBS_dist <- living_stand_dist %>% scale %>% dist %>% hclust(method = "single")
CBS_dend <- as.dendrogram(CBS_dist)
#labels(CBS_dend) <- CBS_semp20$'שם.ישוב'
CBS_plot <- ggplot(CBS_dend %>% set('branches_k_color', k = 4) %>%
set('branches_lwd', 0.7) %>%
set('labels_colors', k = 4) %>%
set('labels_cex', 0.8),
horiz = TRUE)
# CBS_plot
dend_list <- dendlist(knesst_dend, CBS_dend) %>%  untangle() %>% tanglegram()
